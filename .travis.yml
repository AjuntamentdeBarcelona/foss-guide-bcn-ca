# This script needs that environment variables $DEPLOY_REPO and
# $DEPLOY_REPO_DEVELOP are defined in Travis CI Repository Settings. They need
# to be a valid GitHub SLUG (owner_name/repo_name) pointing to the repository
# where the result of this script (HTML document generated by sphinx-versioning)
# is supposed to be deployed (in branch gh-pages).

# A hidden variable $GITHUB_TOKEN also needs to be defined in Travis CI
# Repository Settings, containing an API token generated in GitHub.

language: python
python:
  - 3.5
script:
  - mkdir -p build/html && touch build/html/.nojekyll
after_success:                          # Document is built here
  - sphinx-versioning build --show-banner -w master -W "[0-9]+\.[0-9]+" source build/html/ca
deploy:
  - provider: pages
    on:
      branch: master
    skip-cleanup: true                  # Keep files generated during the build
    github-token: $GITHUB_TOKEN         # Set in travis-ci.org dashboard, marked secure
    repo: $DEPLOY_REPO
    target-branch: gh-pages
    local-dir: build/html
    keep-history: false                 # Overwrite 'target-branch' in every push
  - provider: pages
    on:
      branch: develop
    skip-cleanup: true                  # Keep files generated during the build
    github-token: $GITHUB_TOKEN         # Set in travis-ci.org dashboard, marked secure
    repo: $DEPLOY_REPO_DEVELOP
    target-branch: gh-pages
    local-dir: build/html
    keep-history: false                 # Overwrite 'target-branch' in every push
branches:
  only:
    - master
    - develop
